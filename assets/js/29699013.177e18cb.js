"use strict";(self.webpackChunkdeveloper_site=self.webpackChunkdeveloper_site||[]).push([[598],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=o.createContext({}),h=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=h(e.components);return o.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=h(n),u=a,m=d["".concat(c,".").concat(u)]||d[u]||l[u]||r;return n?o.createElement(m,s(s({ref:t},p),{},{components:n})):o.createElement(m,s({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var h=2;h<r;h++)s[h]=n[h];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1390:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return u},frontMatter:function(){return i},metadata:function(){return h},toc:function(){return l}});var o=n(3117),a=n(102),r=(n(7294),n(3905)),s=["components"],i={title:"Application logic",sidebar_label:"App logic"},c=void 0,h={unversionedId:"tech/conversation/app-logic",id:"tech/conversation/app-logic",title:"Application logic",description:"On the hub, you define the logic of an application describing",source:"@site/docs/tech/conversation/app-logic.md",sourceDirName:"tech/conversation",slug:"/tech/conversation/app-logic",permalink:"/developer/docs/tech/conversation/app-logic",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/tech/conversation/app-logic.md",tags:[],version:"current",lastUpdatedAt:1645789884,formattedLastUpdatedAt:"2/25/2022",frontMatter:{title:"Application logic",sidebar_label:"App logic"},sidebar:"tech",next:{title:"Norms",permalink:"/developer/docs/tech/conversation/norms"}},p={},l=[{value:"Echo",id:"echo",level:2},{value:"Ask for Help",id:"ask-for-help",level:2}],d={toc:l};function u(e){var t=e.components,n=(0,a.Z)(e,s);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"On the hub, you define the logic of an application describing\nthe type of tasks that can be done on it. You can read about the\nmodel at ",(0,r.kt)("a",{parentName:"p",href:"https://internetofus.github.io/developer/docs/tech/conversation/models"},"the models' section on the developer documentation"),".\nTo help you understand this structure in the next sections,\nyou can find different examples that may help you."),(0,r.kt)("h2",{id:"echo"},"Echo"),(0,r.kt)("p",null,"A simple application that replies to the same user with the message that is sent.\nFor this purpose, we need to define the action or transaction with the message to reply.\nSo, you need to edit the transactions section of the logic and add:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "echo": {\n            "type": "object",\n            "description": "Send the echo message",\n            "properties": {\n                "message": {\n                    "type": "string",\n                    "description": "The message to echo"\n                }\n            }\n    }\n}\n')),(0,r.kt)("p",null,"On this code is described a transaction with the label ",(0,r.kt)("strong",{parentName:"p"},"echo")," that has an attribute\nnamed ",(0,r.kt)("strong",{parentName:"p"},"message")," with the text to reply. As a result of this action, the application will\nreceive a message or callback. This kind of data is defined in the callbacks section\nof the logic. For this example it will be:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "echo": {\n            "type": "object",\n            "properties": {\n                "taskId": {\n                    "type": "string",\n                    "description": "The identifier of the task"\n                },\n                "message": {\n                    "type": "string",\n                    "description": "The echo message"\n                }\n            }\n    }\n}\n')),(0,r.kt)("p",null,"This code defines that the application will receive a message with the label ",(0,r.kt)("strong",{parentName:"p"},"echo")," and\nwith the attributes ",(0,r.kt)("strong",{parentName:"p"},"taskId")," with the task identifier, and ",(0,r.kt)("strong",{parentName:"p"},"message")," with the reply message.\nFinally, we need to define the ",(0,r.kt)("strong",{parentName:"p"},"norms")," that describe the behaviour of the users. For this example\nyou must write the next code on the norms section of the logic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "whenever": "is_received_created_task()",\n        "thenceforth": "add_created_transaction()"\n    },\n    {\n        "whenever": "is_received_do_transaction(\'echo\',Content) and get_profile_id(Me)",\n        "thenceforth": "add_message_transaction() and send_message(Me,\'echo\',Content)"\n    },\n    {\n        "whenever": "is_received(_,\'echo\',Content) and get_task_id(TaskId) and get_attribute(Message,message,@(null),Content)",\n        "thenceforth": "send_user_message(\'echo\',json([taskId=TaskId,message=Message]))"\n    }\n]\n')),(0,r.kt)("p",null,"The first norm is used to store on the task a transaction to mark when the task is created.\nThe second norm is activated when the user tries to do the ",(0,r.kt)("strong",{parentName:"p"},"echo")," transaction and as result,\nit sends a message of the norm engine of the user with the message to reply. The last norm\nis activated when is received message create the callback message and notify the application.\nYou can not notify directly to the user, because the user can have private norms that filter\nthe messages that it can receive."),(0,r.kt)("h2",{id:"ask-for-help"},"Ask for Help"),(0,r.kt)("p",null,"Imagine a simple application that allows a user to ask for help from another one.\nThe first thing to do is define which information has to be provided by the user\nthat wants help.  A ",(0,r.kt)("a",{parentName:"p",href:"https://internetofus.github.io/developer/docs/tech/conversation/models"},"task model"),"\nhas the attribute ",(0,r.kt)("strong",{parentName:"p"},"goal")," that we can use to describe which want the user wants.\nBut this is not enough, we need to limit the number of users that you can ask\nfor help to not annoy all the users of the application. For this, we need\nto define some attributes on the logic. They are defined as an object using\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://swagger.io/specification/"},"OpenAPI specification"),". In the next\nexample, you can see the attributes with the property ",(0,r.kt)("strong",{parentName:"p"},"maxUsers")," that define\nthe number maximum of users to ask for help. It is a value on the range ","[1,7]",".\nSo, when a user will create a new task to ask for help it has to define the goal\nwith the needed description and with the attribute ",(0,r.kt)("strong",{parentName:"p"},"maxUsers")," with the number\nmaximum of other users to ask for help."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "type": "object",\n    "properties": {\n            "maxUsers": {\n                "description": "The maximum number of users to ask",\n                "type": "integer",\n                "nullable": false,\n                "minimum": 1,\n                "maximum": 7\n            }\n    },\n    "required": [\n        "maxUsers"\n    ]\n}\n')),(0,r.kt)("p",null,"After that, we need to define the actions that the users can do on the task and\nthe messages that the users can receive from others on the task. In both cases,\nthey are defined as a JSON object where the key is the label of the action/message\nand the value is a JSON object that describes the attributes of the action/message\nusing the ",(0,r.kt)("a",{parentName:"p",href:"https://swagger.io/specification/"},"OpenAPI specification"),".\nThe actions that a user can do on the task are defined on the ",(0,r.kt)("strong",{parentName:"p"},"transactions"),"\nfield of the application logic. Also, they are mapped to the task transaction\ndata ",(0,r.kt)("a",{parentName:"p",href:"https://internetofus.github.io/developer/docs/tech/conversation/models"},"model"),".\nFollowing the example, we need to add the actions to accept or decline to help.\nOn the last one, we need to add an optional attribute that allows explaining why\nit wants to help. The next JSON object is how to define this."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "acceptToHelp": {\n            "title": "Accept to help the requester",\n            "type": "object",\n            "nullable": true\n    },\n    "denyToHelp": {\n            "title": "Deny to help the requester",\n            "type": "object",\n            "properties": {\n                "reason": {\n                    "description": "The reason why cannot help",\n                    "type": "string",\n                    "nullable": true\n                }\n            }\n    }\n}\n')),(0,r.kt)("p",null,"For the messages that the users can receive from others, we need to define\nthe ",(0,r.kt)("strong",{parentName:"p"},"callbacks")," of the application logic. We need to notify some users\nif they want to help, also need to notify the requester if the user accepts or\nnot to help. The definition of these callbacks follows the same structure\nthat the transactions as you can see on the next JSON object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "doYouWantToHelp": {\n            "title": "Ask to the user if wants to help",\n            "type": "object",\n            "nullable": true\n    },\n    "foundVolunteer": {\n            "title": "Inform that found a volunteer to help",\n            "type": "object",\n            "properties": {\n                "userId": {\n                    "description": "The identifier of the user that want to help",\n                    "type": "string",\n                    "nullable": false\n                }\n            },\n            "required": [\n                "userId"\n            ]\n    },\n    "cannotHelp": {\n            "title": "Inform that a user cannot help",\n            "type": "object",\n            "properties": {\n                "userId": {\n                    "description": "The identifier of the user that cannot help",\n                    "type": "string",\n                    "nullable": false\n                },\n                "reason": {\n                    "description": "The reason why cannot help",\n                    "type": "string",\n                    "nullable": true\n                }\n            },\n            "required": [\n                "userId"\n            ]\n    }\n}\n')),(0,r.kt)("p",null,"Finally, we need to create the ",(0,r.kt)("strong",{parentName:"p"},"norms")," that define how the interactions\nbetween the users can be done. For the example, we need to define the next norms:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When the task is created notify some users if they want to help."),(0,r.kt)("li",{parentName:"ul"},"When a user wants to provide help notify the requester user."),(0,r.kt)("li",{parentName:"ul"},"When a user does not want to help notify the requester user.")),(0,r.kt)("p",null,"The definition of these norms is more complex and you can read more about\nhow to do it in the ",(0,r.kt)("a",{parentName:"p",href:"https://internetofus.github.io/developer/docs/tech/conversation/norms"},"norms section"),".\nThe next JSON array shows the possible definition of them for the application\nlogic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "description": "When the task is created choose some random users and notify them",\n        "whenever": "is_received_created_task() and get_users_to_ask(Users)",\n        "thenceforth": "add_created_transaction() and send_messages(Users,\'notifyAskForHelp\',json([]))",\n        "ontology": ":- use_module(library(random)). :- dynamic get_users_to_ask/1. get_users_to_ask(Users) :- get_app_users_except_me(UsersExceptMe), random_permutation(AppUsers,UsersExceptMe),get_task_attribute_value(MaxUsers,\'maxUsers\'),append(Users,_,AppUsers), length(Users,MaxUsers)."\n    },\n    {\n        "description": "Notify user if it can help",\n        "whenever": "is_received(_,\'notifyAskForHelp\',_)",\n        "thenceforth": "send_user_message(\'doYouWantToHelp\',json([]))"\n    },\n    {\n        "description": "Accept to provide help",\n        "whenever": "is_received_do_transaction(\'acceptToHelp\',_) and get_task_requester_id(RequesterId) and get_profile_id(Me)",\n        "thenceforth": "add_message_transaction() and send_message(RequesterId,\'notifyAcceptHelp\',json([userId=Me]))"\n    },\n    {\n        "description": "Notify user taht someone want to help",\n        "whenever": "is_received(_,\'notifyAcceptHelp\',Attributes)",\n        "thenceforth": "send_user_message(\'foundVolunteer\',Attributes)"\n    },\n    {\n        "description": "Do not want to help",\n        "whenever": "is_received_do_transaction(\'denyToHelp\',Attributes) and get_task_requester_id(RequesterId) and get_profile_id(Me) and get_attribute(Reason,reason,@null,Attributes)",\n        "thenceforth": "add_message_transaction() and send_message(RequesterId,\'notifyDenyToHelp\',json([userId=Me,reason=Reason]))"\n    },\n    {\n        "description": "Notify tayt a user cannot help",\n        "whenever": "is_received(_,\'notifyDenyToHelp\',Attributes)",\n        "thenceforth": "send_user_message(\'cannotHelp\',Attributes)"\n    }\n]\n')))}u.isMDXComponent=!0}}]);